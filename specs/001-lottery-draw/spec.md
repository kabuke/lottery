# 規格: 抽獎活動

## 1. 總覽

本規格書描述一個基於 Web 的抽獎應用程式。此應用程式旨在提供一個動態、即時響應的介面，允許活動組織者輕鬆設定獎項與參與者、執行抽獎，並檢視與匯出結果。

### 1.1. 技術棧與目標

- **後端:** Go (v1.24.1 或更高版本)
- **Web 框架:** Gin
- **前端互動:** HTMX
- **部署目標:** 編譯為單一 Linux 執行檔

### 1.2. 專案結構

為確保程式碼的模組化與可維護性，專案應遵循以下目錄結構：

```
lottery/
├── cmd/
│   └── main.go         // 應用程式入口點
├── internal/
│   ├── handlers/         // Gin HTTP 處理器
│   ├── models/           // 資料模型 (獎項、參與者)
│   ├── services/         // 核心業務邏輯 (CSV 解析、抽獎演算法)
│   └── templates/        // HTML 模板 (由 html/template 渲染)
├── web/
│   └── assets/           // 靜態檔案 (CSS, JS, htmx.min.js)
├── go.mod
└── go.sum
```

## 2. 功能需求

### 2.1. 獎項設定

- **手動新增:**
    - UI 必須提供一個表單，允許使用者輸入「獎項名稱」、「獎品名稱」和「數量」及勾選「從所有參與者中抽取 (包括已中獎者)[drawAllFlag]」來手動建立獎項。
    - 提交後，獎項列表應透過 HTMX 局部更新，無需刷新整個頁面。
- **CSV 上傳:**
    - UI 必須提供一個檔案上傳按鈕，允許使用者選擇並上傳 CSV 檔案來批次匯入獎項。
    - CSV 格式為：`獎項名稱,獎品名稱,數量,drawAllFlag`。
    - 上傳成功後，獎項列表應透過 HTMX 局部更新。
    - 系統必須處理 CSV 格式錯誤或內容不完整的情況。
- **列表顯示:**
    - 頁面必須有一個專門的區域，用於即時顯示所有已設定的獎項及其剩餘數量。
- **追加獎項:**
    - 系統必須允許在任何時候追加「額外獎項」，並可為其指定特殊的抽獎規則。

### 2.2. 參與者設定

- **手動新增:**
    - UI 必須提供一個表單，允許使用者輸入「員工編號」和「員工姓名」來手動新增參與者。
    - 提交後，參與者列表應透過 HTMX 局部更新。
- **CSV 上傳:**
    - UI 必須提供一個檔案上傳按鈕，允許使用者選擇並上傳 CSV 檔案來批次匯入參與者。
    - CSV 格式為：`員工編號,員工姓名`。
    - 上傳成功後，參與者列表應透過 HTMX 局部更新。
- **列表顯示:**
    - 頁面必須有一個專門的區域，用於顯示所有已加入的參與者資訊。

### 2.3. 抽獎流程

- **核心邏輯:**
    - 系統必須確保每位參與者最多只能中一個常規獎項。
    - 系統需在記憶體中維護獎項的剩餘數量和未中獎的參與者名單。
- **抽獎介面:**
    - UI 必須提供一個主抽獎介面，包含一個獎項下拉選單和一個「開始抽獎」按鈕。
    - 點擊按鈕後，系統應執行抽獎，並透過 HTMX 在結果區動態顯示中獎者資訊。
    - 建議加入簡單的動畫或視覺效果來提升抽獎過程的體驗。
- **額外獎項規則:**
    - 在抽取標記為「額外獎項」的獎品時，UI 必須提供選項讓使用者決定抽獎範圍：
        - **選項 A:** 從所有參與者中抽取（無論其是否已中獎）。
        - **選項 B:** 僅從尚未中獎的參與者中抽取。

### 2.4. 結果顯示與匯出

- **即時結果:**
    - UI 必須提供一個列表，在每次抽獎後即時更新，顯示所有已抽出的獎項與對應的中獎人。
- **結果匯出:**
    - 系統必須提供一個「下載抽獎結果」按鈕。
    - 點擊後，應產生一份包含所有中獎紀錄的 CSV 檔案供使用者下載。
    - 匯出的 CSV 格式為：`獎項名稱,員工編號,員工姓名,獎品名稱`。

## 3. 非功能性需求

- **使用者體驗:** 介面應簡潔直觀，並利用 HTMX 提供流暢、無刷新的互動體驗。
- **公平性:** 中獎者的選擇必須是基於均勻分佈的隨機演算法，確保對所有參與者公平。
- **效能:** 應用程式應能高效處理數千名參與者的抽獎，並在記憶體使用上保持效率。
